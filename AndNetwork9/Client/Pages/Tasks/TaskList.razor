@page "/Task"
<BaseBodyWithAside>
    <Title>
        Задачи
    </Title>
    <Main>
        @if (InitiatorMode || CurrentViewType != ViewType.Unassigned)
        {
            <div class="accordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" data-bs-target="#collapseOne" data-bs-toggle="collapse" type="button">
                            @(!InitiatorMode ? "Активные" : "Требуют внимания")
                        </button>
                    </h2>
                    <div class="accordion-collapse collapse show" id="collapseOne">
                        <div class="accordion-body" style="max-height: 50vh; overflow-y: scroll">
                            @if (AssigneeActive is not null)
                            {
                                <Virtualize Context="task" Items="AssigneeActive" OverscanCount="2">
                                    <TaskShortCard Task="task"/>
                                </Virtualize>
                            }
                            else
                            {
                                <LoadingSpinner/>
                            }
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" data-bs-target="#collapseTwo" data-bs-toggle="collapse" type="button">
                            @(!InitiatorMode ? "На анализе у инициатора" : "Назначены на исполнителя")
                        </button>
                    </h2>
                    <div class="accordion-collapse collapse" id="collapseTwo">
                        <div class="accordion-body" style="max-height: 50vh; overflow-y: scroll">
                            @if (AssigneeOnInitiator is not null)
                            {
                                <Virtualize Context="task" Items="AssigneeOnInitiator" OverscanCount="2">
                                    <TaskShortCard Task="task"/>
                                </Virtualize>
                            }
                            else
                            {
                                <LoadingSpinner/>
                            }
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" data-bs-target="#collapseThree" data-bs-toggle="collapse" type="button">
                            Завершенные
                        </button>
                    </h2>
                    <div class="accordion-collapse collapse" id="collapseThree">
                        <div class="accordion-body" style="max-height: 50vh; overflow-y: scroll">
                            @if (AssigneeEnd is not null)
                            {
                                <Virtualize Context="task" Items="AssigneeEnd" OverscanCount="2">
                                    <TaskShortCard Task="task"/>
                                </Virtualize>
                            }
                            else
                            {
                                <LoadingSpinner/>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="accordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" data-bs-target="#collapseOne" data-bs-toggle="collapse" type="button">
                            Задачи без исполнителя
                        </button>
                    </h2>
                    <div class="accordion-collapse collapse show" id="collapseOne">
                        <div class="accordion-body" style="max-height: 50vh; overflow-y: scroll">
                            @if (AssigneeActive is not null)
                            {
                                <Virtualize Context="task" Items="AssigneeActive" OverscanCount="2">
                                    <TaskShortCard Task="task"/>
                                </Virtualize>
                            }
                            else
                            {
                                <LoadingSpinner/>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }

    </Main>
    <Aside>
        <div class="d-grid mb-3">
            <a class="btn btn-success mb-1" href="/task/new">Создать задачу</a>
        </div>
        <h5>Параметры отображения</h5>
        <div class="form-check mb-3">
            <input class="form-check-input" id="flexCheckDefault" @onclick="() => InitiatorMode = !InitiatorMode" type="checkbox" value="@InitiatorMode">
            <label class="form-check-label" for="initiatorModeCheckbox">
                Режим инициатора
            </label>
        </div>
        <EditForm Model="@CurrentViewTypeInt">

            <div class="form-check">
                <input checked="@(CurrentViewTypeInt == 0)" class="form-check-input" disabled="@InitiatorMode" id="viewMode1" Name="Me" @onclick="() => CurrentViewTypeInt = 0" type="radio" value="0"/>
                <label class="form-check-label" for="viewMode1">
                    Мои задачи
                </label>
            </div>
            <div class="form-check">
                <input checked="@(CurrentViewTypeInt == 1)" class="form-check-input" disabled="@InitiatorMode" id="viewMode2" Name="SquadPart" @onclick="() => CurrentViewTypeInt = 1" type="radio" value="1"/>
                <label class="form-check-label" for="viewMode2">
                    Задачи отделения
                </label>
            </div>
            <div class="form-check">
                <input checked="@(CurrentViewTypeInt == 2)" class="form-check-input" disabled="@InitiatorMode" id="viewMode3" Name="Squad" @onclick="() => CurrentViewTypeInt = 2" type="radio" value="2"/>
                <label class="form-check-label" for="viewMode3">
                    Задачи отряда
                </label>
            </div>
            <div class="form-check">
                <input checked="@(CurrentViewTypeInt == 3)" class="form-check-input" disabled="@InitiatorMode" id="viewMode4" Name="Direction" @onclick="() => CurrentViewTypeInt = 3" type="radio" value="3"/>
                <label class="form-check-label" for="viewMode4">
                    Задачи направления
                </label>
            </div>
            <div class="form-check">
                <input checked="@(CurrentViewTypeInt == 4)" class="form-check-input" disabled="@InitiatorMode" id="viewMode5" Name="Unassigned" @onclick="() => CurrentViewTypeInt = 4" type="radio" value="4"/>
                <label class="form-check-label" for="viewMode5">
                    Задачи без исполнителя
                </label>
            </div>
        </EditForm>
    </Aside>
    <Footer>

    </Footer>
</BaseBodyWithAside>